# Windows锁定并拍照工具 (LockAndCapture)

一个轻量级的Windows工具，运行后立即通过摄像头拍照，然后自动锁定Windows系统。单文件设计，双击即可使用，无需安装额外依赖（打包后）。

## 功能特点

✅ **自动拍照**：运行后自动检测摄像头并捕获图像  
✅ **系统锁定**：拍照完成后自动锁定Windows工作站  
✅ **用户友好**：清晰的Windows原生消息框提示  
✅ **详细日志**：完整的操作日志记录，便于排查问题  
✅ **鲁棒性强**：无摄像头时可选择是否继续锁定系统  
✅ **单文件运行**：支持打包为独立可执行文件  

## 环境要求

### 运行环境
- Windows 7/8/10/11 (32/64位)
- 摄像头（可选，无摄像头仍可使用锁定功能）
- Python 3.6+（源码运行时）

### 依赖库（源码运行）
```bash
pip install opencv-python pywin32
```

## 使用方法

### 方式1：直接运行可执行文件（推荐）
1. 下载打包好的`LockAndCapture.exe`文件
2. 双击运行（建议以普通用户权限运行）
3. 按照提示操作：
   - 程序会先显示提示消息
   - 自动检测摄像头并拍照
   - 拍照完成后自动锁定系统
   - 若无摄像头，会询问是否仍要锁定系统

### 方式2：源码运行
1. 克隆或下载本文件
2. 安装依赖：`pip install opencv-python pywin32`
3. 运行脚本：`python lock_and_capture.py`

## 文件说明

| 文件/目录 | 说明 |
|-----------|------|
| `lock_and_capture.py` | 主程序源码 |
| `LockAndCapture.exe` | 打包后的可执行文件（需自行打包） |
| `LockAndCapture.log` | 日志文件（运行后自动生成） |
| `capture_YYYYMMDD_HHMMSS.jpg` | 捕获的照片（运行后自动生成） |

## 打包为单文件（可选）

使用PyInstaller打包为独立可执行文件：

```bash
# 安装PyInstaller
pip install pyinstaller

# 打包命令
pyinstaller --onefile --windowed --name LockAndCapture lock_and_capture.py
```

打包后的文件位于`dist`目录下。

## 工作流程

1. 程序启动，显示提示消息
2. 检测可用摄像头（前5个ID）
3. 若检测到摄像头：
   - 初始化摄像头并捕获图像
   - 保存图像到程序运行目录
4. 若未检测到摄像头：
   - 弹出确认框询问是否继续锁定系统
5. 执行系统锁定操作
6. 记录所有操作到日志文件

## 日志说明

日志文件`LockAndCapture.log`包含以下信息：
- 程序启动/退出时间
- 摄像头检测结果
- 拍照操作状态
- 系统锁定结果
- 错误信息（如有）

## 常见问题

### Q1: 程序提示"未检测到可用摄像头"
- 检查摄像头是否正常连接
- 确保摄像头未被其他程序占用
- 尝试插拔摄像头或重启电脑

### Q2: 拍照成功但图片是黑屏/模糊
- 摄像头需要时间对焦，程序已内置0.5秒延迟
- 可修改代码中`time.sleep(0.5)`增加延迟时间
- 检查摄像头硬件是否正常

### Q3: 系统锁定功能失效
- 确保Windows账户设置了密码
- 以管理员权限运行程序（部分系统需要）
- 检查Windows组策略是否禁用了工作站锁定功能

### Q4: 日志文件无法生成
- 检查程序运行目录的写入权限
- 尝试将程序移动到用户目录（如桌面）运行

## 权限说明

- 无需管理员权限即可运行（部分系统锁定功能可能需要）
- 需要摄像头访问权限
- 需要写入文件权限（保存照片和日志）

## 版本信息

- 版本：1.0
- 开发语言：Python 3
- 许可证：MIT

## 免责声明

1. 本工具仅用于合法合规场景
2. 使用前请确保拥有摄像头使用权限
3. 作者不对因使用本工具造成的任何损失负责
4. 请遵守当地法律法规和公司规章制度

## 故障排除

如果程序运行异常：
1. 查看`LockAndCapture.log`日志文件
2. 检查依赖库是否正确安装（源码运行）
3. 确认摄像头驱动是否正常
4. 尝试以管理员身份运行
5. 检查Windows系统是否禁用了相关API
